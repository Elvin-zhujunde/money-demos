import{_ as H,r as _,a as J,j as K,b as p,d as U,c as s,w as l,g as b,h as f,i as d,o as u,e as n,F as y,k as q,l as w,f as O,t as x}from"./index-9778kytf.js";const P={class:"register-container"},Q={class:"register-box"},W={class:"form-footer"},X={__name:"index",setup(Y){const R=O(),C=_(null),j=_(!1),B=_([]),k=_([]),v=_([]),a=J({role:"student",student_id:"",teacher_id:"",name:"",password:"",gender:"男",email:"",address:"",department_id:"",major_id:"",class_id:"",title:""}),V={student_id:[{required:!0,message:"请输入学号"}],teacher_id:[{required:!0,message:"请输入教师编号"}],name:[{required:!0,message:"请输入姓名"}],password:[{required:!0,message:"请输入密码"}],gender:[{required:!0,message:"请选择性别"}],email:[{required:!0,message:"请输入邮箱"},{type:"email",message:"请输入有效的邮箱地址"}],department_id:[{required:!0,message:"请选择院系"}],major_id:[{required:!0,message:"请选择专业"}],class_id:[{required:!0,message:"请选择班级"}],title:[{required:!0,message:"请选择职称"}]},F=async()=>{try{const r=await b.get("/departments");r.data.success&&(B.value=r.data.data)}catch(r){console.error("获取院系列表失败:",r),f.error("获取院系列表失败")}},M=async r=>{try{const e=await b.get("/majors",{params:{department_id:r}});e.data.success&&(k.value=e.data.data)}catch(e){console.error("获取专业列表失败:",e),f.error("获取专业列表失败")}},N=async r=>{try{const e=await b.get("/classes",{params:{major_id:r}});e.data.success&&(v.value=e.data.data)}catch(e){console.error("获取班级列表失败:",e),f.error("获取班级列表失败")}},S=()=>{var r;(r=C.value)==null||r.clearValidate()},E=async r=>{a.major_id="",a.class_id="",k.value=[],v.value=[],r&&await M(r)},I=async r=>{a.class_id="",v.value=[],r&&await N(r)},L=async()=>{var r,e;j.value=!0;try{(await b.post("/register",a)).data.success&&(f.success("注册成功"),R.push("/login"))}catch(i){console.error("注册失败:",i),f.error(((e=(r=i.response)==null?void 0:r.data)==null?void 0:e.message)||"注册失败")}finally{j.value=!1}};return K(()=>{F()}),(r,e)=>{const i=d("a-radio"),D=d("a-radio-group"),o=d("a-form-item"),g=d("a-input"),T=d("a-input-password"),m=d("a-select-option"),c=d("a-select"),z=d("a-button"),A=d("router-link"),G=d("a-form");return u(),p("div",P,[U("div",Q,[e[21]||(e[21]=U("h2",null,"用户注册",-1)),s(G,{model:a,rules:V,ref_key:"formRef",ref:C,onFinish:L},{default:l(()=>[s(o,{name:"role"},{default:l(()=>[s(D,{value:a.role,"onUpdate:value":e[0]||(e[0]=t=>a.role=t),onChange:S},{default:l(()=>[s(i,{value:"student"},{default:l(()=>e[11]||(e[11]=[n("学生")])),_:1}),s(i,{value:"teacher"},{default:l(()=>e[12]||(e[12]=[n("教师")])),_:1})]),_:1},8,["value"])]),_:1}),s(o,{label:a.role==="student"?"学号":"教师编号",name:a.role==="student"?"student_id":"teacher_id"},{default:l(()=>[s(g,{value:a[a.role==="student"?"student_id":"teacher_id"],"onUpdate:value":e[1]||(e[1]=t=>a[a.role==="student"?"student_id":"teacher_id"]=t)},null,8,["value"])]),_:1},8,["label","name"]),s(o,{label:"姓名",name:"name"},{default:l(()=>[s(g,{value:a.name,"onUpdate:value":e[2]||(e[2]=t=>a.name=t)},null,8,["value"])]),_:1}),s(o,{label:"密码",name:"password"},{default:l(()=>[s(T,{value:a.password,"onUpdate:value":e[3]||(e[3]=t=>a.password=t)},null,8,["value"])]),_:1}),s(o,{label:"性别",name:"gender"},{default:l(()=>[s(D,{value:a.gender,"onUpdate:value":e[4]||(e[4]=t=>a.gender=t)},{default:l(()=>[s(i,{value:"男"},{default:l(()=>e[13]||(e[13]=[n("男")])),_:1}),s(i,{value:"女"},{default:l(()=>e[14]||(e[14]=[n("女")])),_:1})]),_:1},8,["value"])]),_:1}),s(o,{label:"邮箱",name:"email"},{default:l(()=>[s(g,{value:a.email,"onUpdate:value":e[5]||(e[5]=t=>a.email=t)},null,8,["value"])]),_:1}),s(o,{label:"地址",name:"address"},{default:l(()=>[s(g,{value:a.address,"onUpdate:value":e[6]||(e[6]=t=>a.address=t)},null,8,["value"])]),_:1}),s(o,{label:"院系",name:"department_id"},{default:l(()=>[s(c,{value:a.department_id,"onUpdate:value":e[7]||(e[7]=t=>a.department_id=t),onChange:E},{default:l(()=>[(u(!0),p(y,null,q(B.value,t=>(u(),w(m,{key:t.department_id,value:t.department_id},{default:l(()=>[n(x(t.department_name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),a.role==="student"?(u(),p(y,{key:0},[s(o,{label:"专业",name:"major_id"},{default:l(()=>[s(c,{value:a.major_id,"onUpdate:value":e[8]||(e[8]=t=>a.major_id=t),onChange:I,disabled:!a.department_id},{default:l(()=>[(u(!0),p(y,null,q(k.value,t=>(u(),w(m,{key:t.major_id,value:t.major_id},{default:l(()=>[n(x(t.major_name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","disabled"])]),_:1}),s(o,{label:"班级",name:"class_id"},{default:l(()=>[s(c,{value:a.class_id,"onUpdate:value":e[9]||(e[9]=t=>a.class_id=t),disabled:!a.major_id},{default:l(()=>[(u(!0),p(y,null,q(v.value,t=>(u(),w(m,{key:t.class_id,value:t.class_id},{default:l(()=>[n(x(t.class_name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","disabled"])]),_:1})],64)):(u(),w(o,{key:1,label:"职称",name:"title"},{default:l(()=>[s(c,{value:a.title,"onUpdate:value":e[10]||(e[10]=t=>a.title=t)},{default:l(()=>[s(m,{value:"教授"},{default:l(()=>e[15]||(e[15]=[n("教授")])),_:1}),s(m,{value:"副教授"},{default:l(()=>e[16]||(e[16]=[n("副教授")])),_:1}),s(m,{value:"讲师"},{default:l(()=>e[17]||(e[17]=[n("讲师")])),_:1})]),_:1},8,["value"])]),_:1})),s(o,null,{default:l(()=>[s(z,{type:"primary","html-type":"submit",block:"",loading:j.value},{default:l(()=>e[18]||(e[18]=[n(" 注册 ")])),_:1},8,["loading"])]),_:1}),U("div",W,[e[20]||(e[20]=n(" 已有账号？ ")),s(A,{to:"/login"},{default:l(()=>e[19]||(e[19]=[n("去登录")])),_:1})])]),_:1},8,["model"])])])}}},$=H(X,[["__scopeId","data-v-3c0d9fb8"]]);export{$ as default};
