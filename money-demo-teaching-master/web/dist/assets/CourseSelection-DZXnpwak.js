import{_ as $,r as f,j as B,b as u,c as I,w as n,g as _,h as d,i as p,o as l,d as N,F as x,e as m,t as h,m as w,l as k}from"./index-9778kytf.js";const V={class:"course-selection"},j={__name:"CourseSelection",setup(z){const c=f(!1),g=f([]),b=[{title:"课程名称",dataIndex:"subject_name",width:"25%"},{title:"授课教师",dataIndex:"teacher_name",width:"15%",customRender:({record:e})=>`${e.teacher_name} (${e.teacher_title})`},{title:"学时",dataIndex:"class_hours",width:"10%"},{title:"学分",dataIndex:"credits",width:"10%"},{title:"课程容量",dataIndex:"capacity",width:"15%"},{title:"操作",dataIndex:"action",width:"15%"}],i=async()=>{c.value=!0;try{const e=localStorage.getItem("userId"),t=await _.get(`/available-courses?student_id=${e}`);t.data.success&&(g.value=t.data.data)}catch(e){console.error("获取课程列表失败:",e),d.error("获取课程列表失败")}finally{c.value=!1}},v=async e=>{var t,o;e.loading=!0;try{const a=localStorage.getItem("userId");(await _.post("/select-course",{student_id:a,course_id:e.course_id})).data.success&&(d.success("选课成功"),await i())}catch(a){console.error("选课失败:",a),d.error(((o=(t=a.response)==null?void 0:t.data)==null?void 0:o.message)||"选课失败")}finally{e.loading=!1}},C=async e=>{var t,o;e.loading=!0;try{const a=localStorage.getItem("userId");(await _.post("/drop-course",{student_id:a,course_id:e.course_id})).data.success&&(d.success("退课成功"),await i())}catch(a){console.error("退课失败:",a),d.error(((o=(t=a.response)==null?void 0:t.data)==null?void 0:o.message)||"退课失败")}finally{e.loading=!1}};return B(()=>{i()}),(e,t)=>{const o=p("a-button"),a=p("a-table"),r=p("a-card");return l(),u("div",V,[I(r,{bordered:!1},{title:n(()=>t[0]||(t[0]=[N("h2",null,"选课管理",-1)])),default:n(()=>[I(a,{columns:b,"data-source":g.value,loading:c.value,pagination:!1,"row-key":"course_id"},{bodyCell:n(({column:y,record:s})=>[y.dataIndex==="capacity"?(l(),u(x,{key:0},[m(h(s.student_count)+"/"+h(s.max_students),1)],64)):w("",!0),y.dataIndex==="action"?(l(),u(x,{key:1},[s.is_selected?(l(),k(o,{key:1,type:"primary",danger:"",size:"small",onClick:S=>C(s),loading:s.loading},{default:n(()=>t[2]||(t[2]=[m(" 退课 ")])),_:2},1032,["onClick","loading"])):(l(),k(o,{key:0,type:"primary",size:"small",disabled:s.student_count>=s.max_students,onClick:S=>v(s),loading:s.loading},{default:n(()=>t[1]||(t[1]=[m(" 选课 ")])),_:2},1032,["disabled","onClick","loading"]))],64)):w("",!0)]),_:1},8,["data-source","loading"])]),_:1})])}}},F=$(j,[["__scopeId","data-v-43086684"]]);export{F as default};
