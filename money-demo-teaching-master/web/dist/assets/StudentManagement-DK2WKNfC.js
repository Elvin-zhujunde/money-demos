import{_ as re,r,a as ie,j as ue,b as c,c as d,w as n,g as v,h as m,i as o,o as i,d as G,F as g,e as l,t as u,m as I,l as h,k as F}from"./index-9778kytf.js";const _e={class:"student-management"},ce={__name:"StudentManagement",setup(me){const j=r(!1),k=r(!1),N=r([]),C=r(!1),w=r(null),V=r([]),y=r(!1),S=r(!1),$=r(null),q=r([]),D=r([]),b=r([]),s=ie({student_id:"",name:"",gender:"",department_id:"",major_id:"",class_id:""}),P={name:[{required:!0,message:"请输入姓名"}],gender:[{required:!0,message:"请选择性别"}],department_id:[{required:!0,message:"请选择院系"}],major_id:[{required:!0,message:"请选择专业"}],class_id:[{required:!0,message:"请选择班级"}]},T=[{title:"学号",dataIndex:"student_id",width:"10%"},{title:"姓名",dataIndex:"name",width:"8%"},{title:"性别",dataIndex:"gender",width:"6%"},{title:"院系",dataIndex:"department_name",width:"12%"},{title:"专业",dataIndex:"major_name",width:"15%"},{title:"班级",dataIndex:"class_name",width:"12%"},{title:"入学日期",dataIndex:"enrollment_date",width:"10%"},{title:"学期",dataIndex:"semester",width:"6%"},{title:"选课数",dataIndex:"course_count",width:"7%"},{title:"GPA",dataIndex:"gpa",width:"7%"},{title:"操作",dataIndex:"action",width:"7%",fixed:"right"}],H=[{title:"课程名称",dataIndex:"subject_name",width:"30%"},{title:"学分",dataIndex:"credits",width:"20%"},{title:"选课时间",dataIndex:"selection_date",width:"25%"},{title:"成绩",dataIndex:"grade",width:"25%"}],M=t=>t?new Date(t).toLocaleDateString("zh-CN"):"-",B=async()=>{j.value=!0;try{const t=localStorage.getItem("userId"),e=await v.get(`/teacher-students/${t}`);e.data.success&&(N.value=e.data.data)}catch(t){console.error("获取学生列表失败:",t),m.error("获取学生列表失败")}finally{j.value=!1}},J=async t=>{w.value=t,C.value=!0,k.value=!0;try{const e=localStorage.getItem("userId"),_=await v.get(`/teacher-student-courses/${e}/${t.student_id}`);_.data.success&&(V.value=_.data.data)}catch(e){console.error("获取选课详情失败:",e),m.error("获取选课详情失败")}finally{k.value=!1}},K=async()=>{try{const t=await v.get("/departments");t.data.success&&(q.value=t.data.data)}catch(t){console.error("获取院系列表失败:",t),m.error("获取院系列表失败")}},E=async t=>{try{const e=await v.get("/majors",{params:{department_id:t}});e.data.success&&(D.value=e.data.data)}catch(e){console.error("获取专业列表失败:",e),m.error("获取专业列表失败")}},z=async t=>{try{const e=await v.get("/classes",{params:{major_id:t}});e.data.success&&(b.value=e.data.data)}catch(e){console.error("获取班级列表失败:",e),m.error("获取班级列表失败")}},Q=async t=>{s.major_id="",s.class_id="",D.value=[],b.value=[],t&&await E(t)},W=async t=>{s.class_id="",b.value=[],t&&await z(t)},X=async t=>{s.student_id=t.student_id,s.name=t.name,s.gender=t.gender,s.department_id=t.department_id,s.major_id=t.major_id,s.class_id=t.class_id,await K(),t.department_id&&await E(t.department_id),t.major_id&&await z(t.major_id),y.value=!0},Y=async()=>{var t,e;try{await $.value.validate(),S.value=!0,(await v.put(`/student/${s.student_id}`,{name:s.name,gender:s.gender,department_id:s.department_id,major_id:s.major_id,class_id:s.class_id})).data.success&&(m.success("更新成功"),y.value=!1,await B())}catch(_){console.error("更新学生信息失败:",_),m.error(((e=(t=_.response)==null?void 0:t.data)==null?void 0:e.message)||"更新失败")}finally{S.value=!1}};return ue(()=>{B()}),(t,e)=>{const _=o("a-button"),Z=o("a-space"),O=o("a-table"),x=o("a-descriptions-item"),ee=o("a-descriptions"),ae=o("a-divider"),te=o("a-spin"),R=o("a-modal"),p=o("a-form-item"),ne=o("a-input"),A=o("a-radio"),se=o("a-radio-group"),L=o("a-select-option"),U=o("a-select"),de=o("a-form"),oe=o("a-card");return i(),c("div",_e,[d(oe,{bordered:!1},{title:n(()=>e[7]||(e[7]=[G("h2",null,"学生管理",-1)])),default:n(()=>[d(O,{columns:T,"data-source":N.value,loading:j.value,pagination:!1,"row-key":"student_id"},{bodyCell:n(({column:a,record:f})=>[a.dataIndex==="gpa"?(i(),c(g,{key:0},[l(u(Number(f.gpa).toFixed(2)||"-"),1)],64)):I("",!0),a.dataIndex==="enrollment_date"?(i(),c(g,{key:1},[l(u(M(f.enrollment_date)),1)],64)):I("",!0),a.dataIndex==="action"?(i(),h(Z,{key:2},{default:n(()=>[d(_,{type:"link",onClick:le=>X(f)},{default:n(()=>e[8]||(e[8]=[l(" 编辑 ")])),_:2},1032,["onClick"]),d(_,{type:"link",onClick:le=>J(f)},{default:n(()=>e[9]||(e[9]=[l(" 查看选课详情 ")])),_:2},1032,["onClick"])]),_:2},1024)):I("",!0)]),_:1},8,["data-source","loading"]),d(R,{open:C.value,"onUpdate:open":e[0]||(e[0]=a=>C.value=a),title:"选课详情",width:"800px",footer:null,destroyOnClose:!0},{default:n(()=>[d(te,{spinning:k.value},{default:n(()=>[d(ee,{column:2,bordered:""},{default:n(()=>[d(x,{label:"学号"},{default:n(()=>{var a;return[l(u((a=w.value)==null?void 0:a.student_id),1)]}),_:1}),d(x,{label:"姓名"},{default:n(()=>{var a;return[l(u((a=w.value)==null?void 0:a.name),1)]}),_:1}),d(x,{label:"班级"},{default:n(()=>{var a;return[l(u((a=w.value)==null?void 0:a.class_name),1)]}),_:1}),d(x,{label:"选课数量"},{default:n(()=>{var a;return[l(u((a=w.value)==null?void 0:a.course_count),1)]}),_:1})]),_:1}),d(ae),d(O,{columns:H,"data-source":V.value,pagination:!1,size:"small"},{bodyCell:n(({column:a,record:f})=>[a.dataIndex==="selection_date"?(i(),c(g,{key:0},[l(u(M(f.selection_date)),1)],64)):I("",!0)]),_:1},8,["data-source"])]),_:1},8,["spinning"])]),_:1},8,["open"]),d(R,{open:y.value,"onUpdate:open":e[6]||(e[6]=a=>y.value=a),title:"修改学生信息",onOk:Y,confirmLoading:S.value},{default:n(()=>[d(de,{model:s,rules:P,ref_key:"editFormRef",ref:$,"label-col":{span:6},"wrapper-col":{span:16}},{default:n(()=>[d(p,{label:"学号",name:"student_id"},{default:n(()=>[G("span",null,u(s.student_id),1)]),_:1}),d(p,{label:"姓名",name:"name"},{default:n(()=>[d(ne,{value:s.name,"onUpdate:value":e[1]||(e[1]=a=>s.name=a)},null,8,["value"])]),_:1}),d(p,{label:"性别",name:"gender"},{default:n(()=>[d(se,{value:s.gender,"onUpdate:value":e[2]||(e[2]=a=>s.gender=a)},{default:n(()=>[d(A,{value:"男"},{default:n(()=>e[10]||(e[10]=[l("男")])),_:1}),d(A,{value:"女"},{default:n(()=>e[11]||(e[11]=[l("女")])),_:1})]),_:1},8,["value"])]),_:1}),d(p,{label:"院系",name:"department_id"},{default:n(()=>[d(U,{value:s.department_id,"onUpdate:value":e[3]||(e[3]=a=>s.department_id=a),onChange:Q},{default:n(()=>[(i(!0),c(g,null,F(q.value,a=>(i(),h(L,{key:a.department_id,value:a.department_id},{default:n(()=>[l(u(a.department_name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),d(p,{label:"专业",name:"major_id"},{default:n(()=>[d(U,{value:s.major_id,"onUpdate:value":e[4]||(e[4]=a=>s.major_id=a),onChange:W,disabled:!s.department_id},{default:n(()=>[(i(!0),c(g,null,F(D.value,a=>(i(),h(L,{key:a.major_id,value:a.major_id},{default:n(()=>[l(u(a.major_name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","disabled"])]),_:1}),d(p,{label:"班级",name:"class_id"},{default:n(()=>[d(U,{value:s.class_id,"onUpdate:value":e[5]||(e[5]=a=>s.class_id=a),disabled:!s.major_id},{default:n(()=>[(i(!0),c(g,null,F(b.value,a=>(i(),h(L,{key:a.class_id,value:a.class_id},{default:n(()=>[l(u(a.class_name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","disabled"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open","confirmLoading"])]),_:1})])}}},fe=re(ce,[["__scopeId","data-v-cced7860"]]);export{fe as default};
