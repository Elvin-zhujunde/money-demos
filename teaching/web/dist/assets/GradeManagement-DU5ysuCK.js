import{_ as z,r as g,j as B,b as i,c as r,w as d,g as f,h as m,i as c,o as l,d as k,l as v,F as y,e as u,t as N,m as V}from"./index-9778kytf.js";const M={class:"grade-management"},S={key:0,class:"grade-cell"},j={class:"grade-actions"},E={__name:"GradeManagement",setup(F){const _=g(!1),p=g([]),x=[{title:"课程名称",dataIndex:"subject_name",width:"25%"},{title:"学号",dataIndex:"student_id",width:"15%"},{title:"学生姓名",dataIndex:"student_name",width:"15%"},{title:"班级",dataIndex:"class_name",width:"20%"},{title:"成绩",dataIndex:"grade",width:"25%"}],h=async()=>{_.value=!0;try{const e=localStorage.getItem("userId"),a=await f.get(`/teacher-grades/${e}`);a.data.success&&(p.value=a.data.data.map(t=>({...t,id:`${t.course_id}-${t.student_id}`,editing:!1,tempGrade:t.grade})))}catch(e){console.error("获取成绩列表失败:",e),m.error("获取成绩列表失败")}finally{_.value=!1}},w=e=>{e.editing=!0,e.tempGrade=e.grade},C=e=>{e.editing=!1,e.tempGrade=e.grade},b=async e=>{var a,t;try{(await f.post("/update-grade",{student_id:e.student_id,course_id:e.course_id,grade:e.tempGrade})).data.success&&(e.grade=e.tempGrade,e.editing=!1,m.success("成绩更新成功"))}catch(n){console.error("更新成绩失败:",n),m.error(((t=(a=n.response)==null?void 0:a.data)==null?void 0:t.message)||"更新成绩失败")}};return B(()=>{h()}),(e,a)=>{const t=c("a-input-number"),n=c("a-button"),G=c("a-table"),I=c("a-card");return l(),i("div",M,[r(I,{bordered:!1},{title:d(()=>a[0]||(a[0]=[k("h2",null,"成绩管理",-1)])),default:d(()=>[r(G,{columns:x,"data-source":p.value,loading:_.value,pagination:!1,"row-key":"id"},{bodyCell:d(({column:$,record:s})=>[$.dataIndex==="grade"?(l(),i("div",S,[s.editing?(l(),v(t,{key:0,value:s.tempGrade,"onUpdate:value":o=>s.tempGrade=o,min:0,max:100,size:"small",style:{width:"80px"}},null,8,["value","onUpdate:value"])):(l(),i(y,{key:1},[u(N(s.grade||"-"),1)],64)),k("div",j,[s.editing?(l(),i(y,{key:0},[r(n,{type:"link",size:"small",onClick:o=>b(s)},{default:d(()=>a[1]||(a[1]=[u(" 保存 ")])),_:2},1032,["onClick"]),r(n,{type:"link",size:"small",onClick:o=>C(s)},{default:d(()=>a[2]||(a[2]=[u(" 取消 ")])),_:2},1032,["onClick"])],64)):(l(),v(n,{key:1,type:"link",size:"small",onClick:o=>w(s)},{default:d(()=>a[3]||(a[3]=[u(" 编辑 ")])),_:2},1032,["onClick"]))])])):V("",!0)]),_:1},8,["data-source","loading"])]),_:1})])}}},D=z(E,[["__scopeId","data-v-927e5019"]]);export{D as default};
